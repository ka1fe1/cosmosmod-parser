package integration

import (
	"encoding/hex"
	"fmt"
	"github.com/kaifei-bianjie/common-parser/codec"
	"github.com/kaifei-bianjie/common-parser/utils"
)

func (s IntegrationTestSuite) TestGov() {
	cases := []SubTest{
		{
			"submitProposal",
			submitProposal,
		},
	}

	for _, t := range cases {
		s.Run(t.testName, func() {
			t.testCase(s)
		})
	}
}

func submitProposal(s IntegrationTestSuite) {
	txBytes, err := hex.DecodeString("0AA9020AA6020A252F636F736D6F732E676F762E763162657461312E4D73675375626D697450726F706F73616C12FC010ABF010A2E2F636F736D6F732E706172616D732E763162657461312E506172616D657465724368616E676550726F706F73616C128C010A1977777777775365727669636520506172616D204368616E676512217777777777557064617465206D6178204D61785265717565737454696D656F75741A4C0A03676F76120D6465706F736974706172616D731A367B226D696E5F6465706F736974223A205B7B22616D6F756E74223A20223130222C2264656E6F6D223A2022756E79616E22207D5D207D120C0A05756E79616E12033130301A2A696161316D756D7672333865647378753471306A7A7436777A61667A6A7A79683239777766396A32613412660A500A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A2103A2436FB2F383FFA6AEE9D6CB5D73E35F72FD0FCB0802AD3DA398A7F724F68F8C12040A020801180512120A0C0A05756E79616E12033830301080B5181A407EE69AD2BA8D37A40F6D81FB8ADB8174078BC9202EAD0D541B7A852028BAC12D4A2DFDDF82DA4F64F50C1E4D08AF6EFC34AC2143B91B4074DA0874F102CD6E5B")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := codec.GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, msg := range authTx.GetMsgs() {
		if bankDoc, ok := s.Gov.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}
